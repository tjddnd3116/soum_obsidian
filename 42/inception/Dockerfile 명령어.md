# Dockerfile
>Docker 이미지가 어떤 단계를 거쳐 빌드돼야 하는지를 담고있는 텍스트 파일
## Dockerfile 포멧
하나의 Dockerfile은 기본적으로 다음과 같은 구조를 가진 여러개의 명령문으로 구성되어 있다.

``` docker
# 주석(Comment)
명령어(INSTRUCTION) 인자(arguments)
```

## FROM 명령문
``` docker
FROM <이미지>
FROM <이미지>:<태그>
```
하나의 Docker 이미지는 base 이미지부터 시작해서 그 위에 새로운 이미지를 중첩해서 여러 단계의 레이어를 쌓아가며 만들어진다.

FROM 명령문은 base이미지를 지정해주기 위해서 사용된다.

## WORKDIR 명령문
WORKDIR 명령문은 컨테이너 상에서 작업 디렉토리 전환을 위해서 사용된다.

WORKDIR 명령문으로 디렉토리를 전환하면 그 이후에 명령문은 해당 디렉토리를 기준으로 실행된다.
``` docker
WORKDIR <이동할 경로>
```

## RUN 명령문
``` docker
RUN ["<커맨드>", "<파라미터1>", "<파라미터2>"]
RUN <전체 커맨드>
```
RUN 명령문은 이미지 빌드 과정에서 필요한 커맨드를 실행하기 위해서 사용된다.

보통 이미지 안에 특정 소프트웨어를 설치하기 위해서 많이 사용된다.

## ENTRYPOINT 명령문
``` docker
ENTRYPOINT ["<커맨드>", "<파라미터1>", "<파라미터2>"]
ENTRYPOINT <전체 커맨드>
```
ENTRYPOINT 명령문은 이미지를 컨테이너로 띄울 때 항상 실행되어야 하는 커맨드를 지정할 때 사용한다.

ENTRYPOINT 명령문은 Docker이미지를 마치 하나의 실행 파일처럼 사용할때 유용하다.

ENTRYPOINT 명령문으로 지정된 커맨드가 실행되고 이 커맨드로 실행된 프로세스가 죽을 때 컨테이너도 따라서 종료되기 때문

## CMD 명령문
``` docker
CMD ["<커맨드>", "<파라미터1>", "<파라미터2>"]
CMD ["<파라미터1>", "<파라미터2>"]
CMD <전체 커맨드>
```
CMD 명령문은 해당 이미지를 컨테이너로 띄울 때 디폴트로 실행할 커맨드나 ENTRYPOINT 명령문으로 지정된 커맨드에 디폴트로 넘길 파라미터를 지정할 때 사용한다.

CMD 명령문은 많은 경우에 ENTRYPOINT 명령문과 함께 사용하게 되는데 ENTRYPOINT 명령문으로는 커맨드를 지정하고,  CMD명령문으로 디폴트 파라미터를 지정해주면 매우 유연하게 이미지를 실행할 수 있게 된다.

	CMD 명령문과 RUN 명령문이 헷갈릴 수가 있다.
	RUN 명령문은 이미지 빌드 시 항상 실행되며 한 Dockerfile에 여러 개의 RUN 명령문을 선언할 수 있다.
	반면에 CMD명령문은 이미지를 container로 띄울때 딱 한번 실행기회를 가지게 되며 이 기회마저도 docker run 커맨드에 인자를 넘길 경우 상실하게 된다.

## EXPOSE 명령문
``` docker
EXPOSE <포트>
EXPOSE <포트>/<프로토콜>
```
EXPOSE 명령문은 네트워크 상에서 컨테이너로 들어오는 트래픽을 리스닝하는 포트와 프로토콜을 지정하기 위해서 사용된다.

TCP와 UDP중 선택할수 있는데 디폴트는 TCP이다.
## COPY/ADD 명령문
``` docker
COPY <src>... <dest>
COPY ["<src>", ... "<dest>"]
```
COPY 명령문은 호스트 컴퓨터에 있는 디렉토리나 파일을 Docker 이미지의 파일 시스템으로 복사하기 위해서 사용된다.

ADD 명령문은 좀더 파워풀한 COPY 명령문이라고 생각할 수 있다.

ADD 명령문은 일반 파일 뿐만 아니라 압축 파일이나 네트워크 상의 파일도 사용할 수 있다.

특수한 파일을 다루는게 아니라면 COPY명령문을 사용하는 것이 권장된다.

## ENV 명령문
``` docker
ENV <키> <값>
ENV <키>=<값>
```
ENV 명령문은 환경변수를 설정하기 위해 사용한다.

ENV 명령문으로 설정된 환경 변수는 이미지 빌드 시에도 사용됨은 물론이고 해당 컨에티어가 돌아가는 애플리케이션도 접근할 수 있다.

## ARG 명령문
``` docker
ARG <이름>
ARG <이름>=<기본 값>
```

ARG 명령문은 docker build 커맨드로 이미지를 빌드시 --build-arg 옵션을 통해 넘길 수 있는 인자를 정의하기 위해 사용한다.

ENV와 달리 ARG로 설정한 값은 이미지가 빌드되는 동안에만 유효하다.

## .dockerignore 파일
Docker 이미지를 빌드할 때 제외 시키고 싶은 파일이 있다면 .dockerignore 파일에 추가해주면 된다.

.dockerignore에 추가된 파일은 RUN, CMD, COPY와 같은 명령문이 해당 파일을 사용할 수 없게된다.
#[[docker]] #[[docker-compose]]